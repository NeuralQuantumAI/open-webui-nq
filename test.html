<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCaaS iOS - Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 8px; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <h1>VibeCaaS iOS - PWA Test Page</h1>
    
    <h2>PWA Features Check</h2>
    <div id="results"></div>
    
    <h2>Actions</h2>
    <button onclick="testServiceWorker()">Test Service Worker</button>
    <button onclick="testNotifications()">Test Notifications</button>
    <button onclick="testInstall()">Test Install Prompt</button>
    <button onclick="window.location.href='index.html'">Go to App</button>
    
    <script>
        const results = document.getElementById('results');
        
        // Check HTTPS
        const isHTTPS = location.protocol === 'https:' || location.hostname === 'localhost';
        results.innerHTML += `<div class="status ${isHTTPS ? 'success' : 'error'}">
            ${isHTTPS ? '✅' : '❌'} HTTPS: ${isHTTPS ? 'Enabled' : 'Required for PWA features'}
        </div>`;
        
        // Check Service Worker support
        const swSupport = 'serviceWorker' in navigator;
        results.innerHTML += `<div class="status ${swSupport ? 'success' : 'error'}">
            ${swSupport ? '✅' : '❌'} Service Worker: ${swSupport ? 'Supported' : 'Not supported'}
        </div>`;
        
        // Check Manifest
        const manifestLink = document.querySelector('link[rel="manifest"]');
        fetch('manifest.json')
            .then(r => r.json())
            .then(manifest => {
                results.innerHTML += `<div class="status success">
                    ✅ Manifest: Found (${manifest.name})
                </div>`;
            })
            .catch(e => {
                results.innerHTML += `<div class="status error">
                    ❌ Manifest: Not found or invalid
                </div>`;
            });
        
        // Check Notification support
        const notifSupport = 'Notification' in window;
        results.innerHTML += `<div class="status ${notifSupport ? 'success' : 'error'}">
            ${notifSupport ? '✅' : '❌'} Notifications: ${notifSupport ? 'Supported' : 'Not supported'}
        </div>`;
        
        // Check PWA install status
        if (window.matchMedia('(display-mode: standalone)').matches) {
            results.innerHTML += `<div class="status success">
                ✅ PWA Mode: Running as installed app
            </div>`;
        } else {
            results.innerHTML += `<div class="status info">
                ℹ️ PWA Mode: Running in browser
            </div>`;
        }
        
        // Test functions
        function testServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => {
                        alert('Service Worker registered successfully!');
                        console.log('Registration:', reg);
                    })
                    .catch(err => {
                        alert('Service Worker registration failed: ' + err.message);
                        console.error('Registration failed:', err);
                    });
            } else {
                alert('Service Workers not supported in this browser');
            }
        }
        
        function testNotifications() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('VibeCaaS Test', {
                            body: 'Notifications are working!',
                            icon: '/icons/icon-192.svg'
                        });
                    } else {
                        alert('Notification permission: ' + permission);
                    }
                });
            } else {
                alert('Notifications not supported');
            }
        }
        
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            results.innerHTML += `<div class="status success">
                ✅ Install Prompt: Available
            </div>`;
        });
        
        function testInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(result => {
                    alert('Install prompt result: ' + result.outcome);
                    deferredPrompt = null;
                });
            } else {
                alert('Install prompt not available. App may already be installed or conditions not met.');
            }
        }
    </script>
</body>
</html>